<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ÄÂ§úÁãº‰∫∫ÊÆ∫ - Âï§ÁâåÈÖí</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Specific styles for onenight-werewolf.html */
        body {
            background-color: var(--dpd-bg-dark);
            color: var(--dpd-text-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Start from top */
            min-height: 100vh;
            padding: 20px;
            text-align: center;
            box-sizing: border-box; /* Include padding in element's total width and height */
        }

        h1, h2, h3, .game-card h3 {
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 700;
            color: #10b981; /* ‰∏ªÈ†ÅÁ∂†Ëâ≤ */
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }
        .game-card {
            background: linear-gradient(145deg, #047857, #065f46);
            border: 3px solid #10b981;
            box-shadow: 0 8px 25px rgba(16,185,129,0.3);
        }

        /* New .setup-section styles */
        .setup {
            background: linear-gradient(135deg, #0f766e, #115e59);
            padding: 25px;
            border-radius: 20px;
            border: 3px solid #10b981;
            box-shadow: 0 15px 40px rgba(16,185,129,0.3);
            margin: 20px 0;
            width: 90%; /* Maintain width from game-section base */
            max-width: 700px;
            box-sizing: border-box;
             display: flex;
            flex-direction: column;
            align-items: center;
        }

        .setup select, .setup button {
            margin: 10px;
        }

        /* .game-section (general card style) to be applied to other sections */
        .game-section {
            background: linear-gradient(145deg, #047857, #065f46);
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(16,185,129,0.3);
            padding: 30px;
            margin-bottom: 20px;
            width: 90%;
            max-width: 700px;
            box-sizing: border-box;
        }

        h1 {
            font-size: 2.5em; /* Keep size consistent with previous h1 */
            margin-bottom: 20px;
        }
        h2 {
            color: #10b981; /* Use the new main green color */
            font-size: 1.8em;
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #065f46; /* A slightly darker green for accent */
            padding-bottom: 10px;
            display: inline-block;
        }

        .player-card h3, .center-card h3, .role-card h3 {
            color: #fbc02d; /* Retain a warm yellow if it's used for contrast, or change to green variant */
        }

        .config-btn {
            padding: 12px 25px;
            margin: 0 10px;
            border: none;
            border-radius: 50px; /* More rounded */
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .config-btn.green {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
        }
        .config-btn.blue {
            background: linear-gradient(45deg, #3b82f6, #2563eb);
            color: white;
        }
        .config-btn.gold {
            background: linear-gradient(45deg, #facc15, #eab308);
            color: #1f2937;
        }

        .config-btn:hover {
             filter: brightness(1.1); /* Slightly brighter on hover */
             transform: translateY(-2px);
             box-shadow: 0 8px 20px rgba(0,0,0,0.4); /* Enhanced shadow on hover */
        }
        .config-btn:disabled {
            background: #6c757d;
            color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .night-phase {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            padding: 30px;
            border-radius: 25px;
            margin: 20px 0;
            border: 4px solid #3b82f6;
            width: 90%; /* Match game-section container width */
            max-width: 700px;
            box-sizing: border-box;
        }

        .night-phase .night-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px; /* Space between night action buttons */
            margin-top: 20px;
        }

        .night-phase .night-btn {
            flex: 1;
            padding: 18px;
            margin: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            backdrop-filter: blur(10px); /* For a glassy effect if possible */
            transition: all 0.3s;
            cursor: pointer;
            min-width: 100px; /* Ensure buttons are not too small */
        }

        .night-phase .night-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);            
        }

        .night-phase .night-btn:disabled {
            background: #6c757d;
            color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .night-phase .night-btn.executed-skill {
            opacity: 0.7; /* Dim out executed skills */
            background: linear-gradient(45deg, #495057, #6c757d); /* Gray out executed buttons */
            cursor: default;
        }

        .night-phase .night-btn.skipped-skill {
            opacity: 0.5;
            background: linear-gradient(45deg, #adb5bd, #ced4da); /* Lighter gray for skipped */
            color: #343a40;
            cursor: default;
        }

        #player-list, #center-cards, #night-actions, #voting-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .player-card, .center-card, .role-card {
            background-color: var(--dpd-card-bg-darker);
            border: 1px solid var(--dpd-border-gray);
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            cursor: pointer; /* For player cards to be clickable */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }
        .center-card, .role-card {
             cursor: default; /* Center cards and role cards are not for clicking */
        }

        .player-card h3, .center-card h3, .role-card h3 {
            color: var(--accent-warm-yellow);
            margin-top: 0;
            margin-bottom: 10px;
        }

        .player-card p, .center-card p, .role-card p {
            font-size: 0.9em;
            color: var(--dpd-text-light);
            word-break: break-word; /* Ensure long role names wrap */
        }

        .hidden-role {
            background-color: #555;
            color: #ccc;
        }

        #discussion-area textarea {
            width: 100%;
            height: 100px;
            background-color: #333;
            color: var(--dpd-text-light);
            border: 1px solid var(--dpd-border-gray);
            border-radius: 8px;
            padding: 10px;
            font-size: 1em;
            box-sizing: border-box;
            margin-top: 10px;
        }

        #voting-selection {
            margin-top: 15px;
        }

        #voting-selection select {
            padding: 8px 10px;
            border-radius: 5px;
            border: 1px solid var(--dpd-border-gray);
            background-color: #333;
            color: var(--dpd-text-light);
            font-size: 1em;
            margin-right: 10px;
        }

        .night-skill-options {
            margin-top: 15px;
            border-top: 1px dashed var(--dpd-border-gray);
            padding-top: 15px;
        }

        .night-skill-options label {
            margin-right: 10px;
            font-weight: bold;
            color: var(--dpd-text-light);
        }

        .night-skill-options select {
            padding: 5px 8px;
            border-radius: 5px;
            border: 1px solid var(--dpd-border-gray);
            background-color: #333;
            color: var(--dpd-text-light);
            font-size: 0.9em;
            margin-right: 10px;
        }

        .night-skill-options button {
            padding: 8px 15px;
            font-size: 0.9em;
        }

        #results-banner {
            font-size: 2.5em;
            color: var(--accent-warm-yellow);
            margin-top: 30px;
            padding: 20px;
            background-color: var(--accent-dark-green);
            border-radius: 15px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }

        footer {
            margin-top: 40px;
            margin-bottom: 20px;
            color: #888;
            font-size: 0.9em;
        }

        #skill-result {
            display: none; 
            background: #1f2937; 
            padding: 20px; 
            border-radius: 15px; 
            margin: 20px 0; 
            border: 3px solid #10b981;
            animation: pulse 0.5s;
            background: linear-gradient(135deg, #1e40af, #1d4ed8);
            border-color: #60a5fa;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            .game-section {
                padding: 20px;
            }
            .game-section h2 {
                font-size: 1.5em;
            }
            .player-card, .role-display {
                padding: 10px 20px;
                font-size: 1em;
            }
            .player-count-selector button, .config-btn {
                padding: 8px 12px;
                font-size: 0.9em;
            }
            .player-card, .center-card, .role-card {
                min-width: 100px;
                padding: 10px;
                margin: 5px;
            }
            .player-card h3, .center-card h3, .role-card h3 {
                font-size: 1.1em;
            }
            .player-card p, .center-card p, .role-card p {
                font-size: 0.8em;
            }
            #results-banner {
                font-size: 1.8em;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">Ëøî‰∏ªÈ†Å</a>
    <h1>‰∏ÄÂ§úÁãº‰∫∫ÊÆ∫ (6‰∫∫)</h1>

    <!-- Ê∫ñÂÇôÂçÄ (Ë∂ÖÁ∞°) -->
    <div class="setup">
      <select id="playerCount" onchange="updatePlayerCount(this.value)">
        <option value="6" selected>6‰∫∫</option>
        <option value="7">7‰∫∫</option>
        <option value="8">8‰∫∫</option>
      </select>

      <div class="name-inputs" style="display:none;">
        <h4>Ëº∏ÂÖ•Áé©ÂÆ∂ÂêçÂ≠óÔºàÂèØÈÅ∏ÔºâÔºö</h4>
        <input id="name1" placeholder="Áé©ÂÆ∂1">
        <input id="name2" placeholder="Áé©ÂÆ∂2">
        <input id="name3" placeholder="Áé©ÂÆ∂3">
        <input id="name4" placeholder="Áé©ÂÆ∂4">
        <input id="name5" placeholder="Áé©ÂÆ∂5">
        <input id="name6" placeholder="Áé©ÂÆ∂6">
        <input id="name7" placeholder="Áé©ÂÆ∂7">
        <input id="name8" placeholder="Áé©ÂÆ∂8">
        <input id="name9" placeholder="Áé©ÂÆ∂9">
        <input id="name10" placeholder="Áé©ÂÆ∂10">
      </div>

      <button onclick="loadRecommended()" class="config-btn green">Êé®Ëñ¶ÈÖçÁΩÆ</button>
      <button onclick="dealCards()" class="config-btn gold">ÁôºÁâå</button>
    </div>

    <!-- ÁµêÊûú (ÂñÆ‰∏ÄÂçÄÂ°ä) -->
    <div id="result-section" class="game-section" style="display:none;">
      <h3>ÁâåÂ±ÄÂàÜÈÖç</h3>
      <div id="players-display"></div>
      <div id="center-display">Ê°å‰∏≠Â§Æ: ???</div>
    </div>

    <div id="private-view" style="display:none;" class="game-section">
      <h3>üëÄ ÁßÅ‰∏ãÊü•ÁúãË∫´‰ªΩ</h3>
      <div id="private-names"></div>
    </div>

    <!-- ÊäÄËÉΩÁµêÊûúÈ°ØÁ§∫ÂçÄ -->
    <div id="skill-result" style="display:none;">
      <h4>üîÆ È†êË®ÄÂÆ∂Êü•È©óÁµêÊûú</h4>
      <div id="prophet-result"></div>
    </div>


    <details style="margin-top: 30px; width: 90%; max-width: 700px;" class="game-section">
        <summary style="font-size: 1.2em; font-weight: bold; color: var(--accent-warm-yellow); cursor: pointer; padding: 10px 0;">ËßíËâ≤ÈÄüÊü•</summary>
        <div id="skill-list" style="text-align: left; padding-top: 10px;">
            <!-- Skills will be populated here by JS -->
        </div>
    </details>

    <footer>
        <p>Âï§ÁâåÈÖí gameüçª - ‰∏ÄÂ§úÁãº‰∫∫ÊÆ∫</p>
    </footer>

    <script>
        const ROLES_ARRAY = ['ÊùëÊ∞ë','ÊùëÊ∞ë','ÊùëÊ∞ë','Áãº‰∫∫','Áãº‰∫∫','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÁöÆÂå†','ÈÖíÈ¨º','Áçµ‰∫∫','ÂÆàÂ§ú‰∫∫','ÂÆàÂ§ú‰∫∫','Â§±Áú†ËÄÖ','Áà™Áâô','ÂåñË∫´ÂπΩÈùà'];
        const ROLES = { // Added camps for win condition logic
            'ÊùëÊ∞ë': { camp: 'Â•Ω‰∫∫', skill: 'ÁÑ°' },
            'Áãº‰∫∫': { camp: 'Áãº‰∫∫', skill: '‰∫íË™çÈöäÂèã(Áç®ÁãºÁúãÊ°å1Âºµ)' },
            'È†êË®ÄÂÆ∂': { camp: 'Â•Ω‰∫∫', skill: 'Êü•1Áé©ÂÆ∂ÊàñÊ°å2Âºµ' },
            'Âº∑Áõú': { camp: 'Â•Ω‰∫∫', skill: 'ÂèØÊèõ1Áé©ÂÆ∂Ë∫´‰ªΩ+Êü•Áúã' },
            'ÊêóËõãÈ¨º': { camp: 'Â•Ω‰∫∫', skill: 'Êèõ2Áé©ÂÆ∂Ë∫´‰ªΩ' },
            'ÁöÆÂå†': { camp: 'Áç®Áãº', skill: 'Ê≠ªÁÑ°ÁãºÊ≠ª=Áç®Âãù' },
            'ÈÖíÈ¨º': { camp: 'Â•Ω‰∫∫', skill: 'Áõ≤ÊèõÊ°å1Âºµ' },
            'Áçµ‰∫∫': { camp: 'Â•Ω‰∫∫', skill: 'Ê≠ªÂ∏∂ÊúÄÂ§öÊäïËÄÖ' },
            'ÂÆàÂ§ú‰∫∫': { camp: 'Â•Ω‰∫∫', skill: 'Áü•Âè¶‰∏ÄÂÆàÂ§ú‰∫∫' },
            'Â§±Áú†ËÄÖ': { camp: 'Â•Ω‰∫∫', skill: 'ÈáçÁúãËá™Â∑±' },
            'Áà™Áâô': { camp: 'Áãº‰∫∫', skill: 'Áü•Áãº‰ΩçÁΩÆ(ÁÑ°ÁãºÊôÇ‰ªª‰∏ÄÊ≠ª=Âãù)' },
            'ÂåñË∫´ÂπΩÈùà': { camp: 'ËÆäË∫´', skill: 'ÈÅ∏1Áé©ÂÆ∂Ë§áË£ΩË∫´‰ªΩ+ÂãùÊ¢ù‰ª∂' }
        };

        const RECOMMENDED_CONFIGS = {
            3: ['Áãº‰∫∫','Áãº‰∫∫','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º'],
            4: ['Áãº‰∫∫','Áãº‰∫∫','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º','ÊùëÊ∞ë'],
            5: ['Áãº‰∫∫','Áãº‰∫∫','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º','Â§±Áú†ËÄÖ','ÊùëÊ∞ë'],
            6: ['ÂåñË∫´ÂπΩÈùà','Áãº‰∫∫','Áãº‰∫∫','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º','Â§±Áú†ËÄÖ','ÊùëÊ∞ë'],
            7: ['ÂåñË∫´ÂπΩÈùà','Áãº‰∫∫','Áãº‰∫∫','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º','Â§±Áú†ËÄÖ','ÊùëÊ∞ë','ÁöÆÂå†'],
            8: ['ÂåñË∫´ÂπΩÈùà','Áãº‰∫∫','Áãº‰∫∫','Áà™Áâô','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º','Â§±Áú†ËÄÖ','ÊùëÊ∞ë','Áçµ‰∫∫'],
            9: ['ÂåñË∫´ÂπΩÈùà','Áãº‰∫∫','Áãº‰∫∫','Áà™Áâô','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º','Â§±Áú†ËÄÖ','ÊùëÊ∞ë','Áçµ‰∫∫','ÁöÆÂå†'],
            10:['ÂåñË∫´ÂπΩÈùà','Áãº‰∫∫','Áãº‰∫∫','Áà™Áâô','È†êË®ÄÂÆ∂','Âº∑Áõú','ÊêóËõãÈ¨º','ÈÖíÈ¨º','Â§±Áú†ËÄÖ','ÊùëÊ∞ë','Áçµ‰∫∫','ÁöÆÂå†','ÊùëÊ∞ë']
        };

        let state = {
            players: [], // [{ id: 'p1', name: '', initialRole: '', currentRole: '', hasViewed: false, voteFor: null }]
            centerCards: [], // [{ id: 'c1', role: '' }]
            rolesInPlay: [], // All N+3 roles for the current game
            nightOrder: ['ÂåñË∫´ÂπΩÈùà', 'Áãº‰∫∫', 'Áà™Áâô', 'ÂÆàÂ§ú‰∫∫', 'È†êË®ÄÂÆ∂', 'Âº∑Áõú', 'ÊêóËõãÈ¨º', 'ÈÖíÈ¨º', 'Â§±Áú†ËÄÖ'],
            currentPhase: 'setup', // 'setup', 'night', 'day', 'results'
            activePlayerIndex: 0,
            activeNightSkillIndex: 0,
            votes: {}, // { 'player_id': count }
            dead: [], // [{ playerId: 'pX', role: 'Role' }]
            messages: [] // For game log/discussion
        };

        let playerCount = 6; // Default to 6 players

        // Utility Functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getRoleDisplayName(role) {
            return role;
        }
        
        function getRoleCamp(role) {
            return ROLES[role] ? ROLES[role].camp : 'Êú™Áü•';
        }

        function getPlayerNames() {
            let names = [];
            const numPlayers = parseInt(document.getElementById('playerCount').value);
            for(let i=1; i<=numPlayers; i++) { // Loop through visible name inputs
                const nameInput = document.getElementById(`name${i}`);
                if (nameInput) {
                    names.push(nameInput.value || `Áé©ÂÆ∂${i}`);
                }
            }
            return names;
        }

        // UI Update Functions
        function renderRoleSkills() {
            const skillListDiv = document.getElementById('skill-list');
            skillListDiv.innerHTML = '';
            for (const role in ROLES) {
                const p = document.createElement('p');
                p.innerHTML = `<strong style="color: var(--accent-warm-yellow);">${role}:</strong> ${ROLES[role].skill || 'ÁÑ°'} (${ROLES[role].camp}Èô£Ááü)`;
                skillListDiv.appendChild(p);
            }
        }

        function updatePlayerCount(count) {
            playerCount = parseInt(count);
            // Show/hide name input fields based on player count
            for(let i=1; i<=10; i++) {
                const nameInput = document.getElementById(`name${i}`);
                if (nameInput) {
                    nameInput.style.display = i <= playerCount ? 'inline-block' : 'none';
                }
            }
        }

        function loadRecommended() {
            const numPlayers = parseInt(document.getElementById('playerCount').value);
            const configRoles = RECOMMENDED_CONFIGS[numPlayers];
            if (configRoles) {
                state.rolesInPlay = [...configRoles];
                document.getElementById('players-display').innerHTML = ``;
                document.getElementById('center-display').textContent = `Ê°å‰∏≠Â§Æ: ???`;
                document.getElementById('result-section').style.display = 'none';

                // Provide a visual cue of selected roles
                let rolesHtml = `<p>Â∑≤ÈÅ∏ÂÆö ${numPlayers} ‰∫∫Â±ÄÊé®Ëñ¶ÈÖçÁΩÆ:</p><div style="display:flex; flex-wrap:wrap; justify-content:center;">`;
                state.rolesInPlay.forEach(role => {
                    rolesHtml += `<span class="role-card" style="padding: 5px 10px; margin: 5px; background: #065f46;">${role}</span>`;
                });
                rolesHtml += `</div>`;
                document.getElementById('players-display').innerHTML = rolesHtml;
                document.getElementById('result-section').style.display = 'block';
            } else {
                alert('ÈÄôÂÄã‰∫∫Êï∏Ê≤íÊúâÊé®Ëñ¶ÈÖçÁΩÆÔºåË´ãÈÅ∏ÊìáÂÖ∂‰ªñ‰∫∫Êï∏„ÄÇ');
            }
        }

        function dealCards() {
            // Re-initialize state for a new game
            state.players = [];
            state.centerCards = [];
            state.votes = {};
            state.dead = [];
            state.messages = [];
            state.activePlayerIndex = 0;
            state.activeNightSkillIndex = 0;
            state.currentPhase = 'playing'; // Change phase after dealing

            const numPlayers = parseInt(document.getElementById('playerCount').value);
            if (!RECOMMENDED_CONFIGS[numPlayers]) {
                alert('Ë´ãÂÖàÈÅ∏ÊìáÊé®Ëñ¶ÈÖçÁΩÆ‰∫∫Êï∏ÔºÅ');
                return;
            }

            const availableRoles = [...RECOMMENDED_CONFIGS[numPlayers]];
            const shuffledRoles = shuffleArray(availableRoles);

            const playerNames = getPlayerNames();

            // Distribute player roles
            for (let i = 0; i < numPlayers; i++) {
                state.players.push({
                    id: `p${i + 1}`,
                    name: playerNames[i], 
                    initialRole: shuffledRoles.shift(),
                    currentRole: '', 
                    hasViewed: false,
                    voteFor: null
                });
            }

            // Distribute center cards
            for (let i = 0; i < 3; i++) {
                state.centerCards.push({ id: `c${i + 1}`, role: shuffledRoles.shift() });
            }

            document.getElementById('result-section').style.display = 'block'; // Show the result area

            // Initial display (all hidden)
            let playersHtml = '<h4>Áé©ÂÆ∂Ë∫´‰ªΩ</h4>';
            state.players.forEach(player => {
                playersHtml += `<div class="player-card"><h3>${player.name}</h3><p>Ë∫´‰ªΩ: ???</p></div>`;
            });
            document.getElementById('players-display').innerHTML = playersHtml;
            document.getElementById('center-display').textContent = `Ê°å‰∏≠Â§Æ: ???`;

            console.log("Game dealt. Players:", state.players, "Center cards:", state.centerCards);

            showPrivateView(); // Call showPrivateView after dealing cards
        }

        function showPrivateView() {
            const privateViewDiv = document.getElementById('private-view');
            const privateNamesDiv = document.getElementById('private-names');
            privateNamesDiv.innerHTML = '';
            
            const playerNames = getPlayerNames();
            const numPlayers = parseInt(document.getElementById('playerCount').value);
            for(let i=0; i<numPlayers; i++) {
                privateNamesDiv.innerHTML += `<button onclick="showIdentity(${i})">${playerNames[i] || 'Áé©ÂÆ∂'+(i+1)}Êü•Áúã</button>`;
            }
            privateViewDiv.style.display = 'block';
        }

        function showIdentity(playerIndex) {
            alert(`‰Ω† (${state.players[playerIndex].name}) ÊòØÔºö${state.players[playerIndex].initialRole} (${getRoleCamp(state.players[playerIndex].initialRole)})`);
        }


        let currentSkillPromises = []; // To handle async prompts for skills

        function activateNightSkill(role, playerWhoUsedSkill) {
            const skillResultDiv = document.getElementById('skill-result');
            const prophetResultDiv = document.getElementById('prophet-result');
            prophetResultDiv.innerHTML = ''; // Clear previous results
            skillResultDiv.style.display = 'block';

            let resultMessage = '';

            // User defined skills handling for private view
            prophetResultDiv.innerHTML = resultMessage; // Display default message

            switch (role) {
                case 'È†êË®ÄÂÆ∂':
                    showProphetCheck();
                    break;
                case 'Áãº‰∫∫':
                    // Simplified for now, just displays info
                    const werewolves = state.players.filter(p => p.initialRole === 'Áãº‰∫∫');

                    if (werewolves.length === 1 && playerWhoUsedSkill.initialRole === 'Áãº‰∫∫') {
                        let choice = prompt("‰Ω†‰øÇÁç®ÁãºÔºÅËº∏ÂÖ•1, 2 Êàñ 3 (Ê°åÁâåÁ∑®Ëôü) Êü•Áúã‰∏ÄÂºµÊ°åÁâåÔºö");
                        let targetCardIndex = parseInt(choice) - 1; // Adjust for 0-indexed array
                        if (targetCardIndex >= 0 && targetCardIndex < state.centerCards.length) {
                            resultMessage = `Áç®ÁãºÊü•Áúã‰∫ÜÊ°åÈù¢Áâå ${targetCardIndex + 1}: ${state.centerCards[targetCardIndex].role} (${getRoleCamp(state.centerCards[targetCardIndex].role)}Èô£Ááü)„ÄÇ`;
                        } else {
                            resultMessage = "ÁÑ°ÊïàÈÅ∏Êìá„ÄÇ";
                        }
                    } else if (werewolves.length > 1) {
                        resultMessage = `‰Ω†Âìã‰øÇÁãº‰∫∫ÈöäÂèã: ${werewolves.map(w => w.name).join(', ')}„ÄÇ`;
                    } else {
                        resultMessage = 'ÂÜáÁãº‰∫∫Âï¶ÔºÅ';
                    }
                    prophetResultDiv.innerHTML = resultMessage;
                    break;
                case 'ÈÖíÈ¨º':
                    resultMessage = "Â∑≤Áõ≤ÊèõÊ°åÁâå„ÄÇ";
                    prophetResultDiv.innerHTML = resultMessage;
                    prompt("Ë´ãÂÜçËº∏ÂÖ•‰Ω†ÊÉ≥‰∫§ÊèõÊ°åÁâåÁöÑ‰ΩçÁΩÆ(1-3)"); 
                    break;
                // For other roles, a simple message might suffice or they might have no active skill.
                default:
                    resultMessage = `${role}: ÁÑ°ÁâπÊÆäÂ§úÈñìË°åÂãï„ÄÇ`;
                    prophetResultDiv.innerHTML = resultMessage;
                    break;
            }
        }


        function showProphetCheck() {
            const numPlayers = parseInt(document.getElementById('playerCount').value);
            let choice = prompt(`Ëº∏ÂÖ•Áé©ÂÆ∂Á∑®Ëôü (1-${numPlayers}) Êàñ 0 (Ê°åÁâå):`);
            let target = parseInt(choice);
            
            let result;
            if (target === 0) {
                const centerCardIndex = Math.floor(Math.random() * state.centerCards.length);
                const card = state.centerCards[centerCardIndex];
                result = `Ê°å‰∏≠Â§ÆÁâå ${centerCardIndex + 1}: ${card.role} (${getRoleCamp(card.role)}Èô£Ááü)`;
            } else if (target >= 1 && target <= numPlayers) {
                const player = state.players[target - 1];
                result = `${player.name}: ${player.initialRole} (${getRoleCamp(player.initialRole)}Èô£Ááü)`;
            } else {
                result = "ÁÑ°ÊïàÈÅ∏Êìá„ÄÇ";
            }
            
            document.getElementById('prophet-result').innerHTML = result;
            document.getElementById('skill-result').style.display = 'block';
        }

        function getRecommended(count) {
           return RECOMMENDED_CONFIGS[count] ? [...RECOMMENDED_CONFIGS[count]] : null;
        }

        function showPlayers(playerRoles) {
            const playersDisplayDiv = document.getElementById('players-display');
            playersDisplayDiv.innerHTML = '<h4>Áé©ÂÆ∂Ë∫´‰ªΩ</h4>';
            playerRoles.forEach((role, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.classList.add('player-card');
                playerDiv.innerHTML = `<h3>Áé©ÂÆ∂${index + 1}</h3><p>Ë∫´‰ªΩ: ${role}</p>`;
                playersDisplayDiv.appendChild(playerDiv);
            });
        }

        function showCenter(centerRoles) {
            const centerDisplayDiv = document.getElementById('center-display');
            centerDisplayDiv.innerHTML = '<h4>Ê°å‰∏≠Â§ÆÁâå</h4>';
            centerRoles.forEach((role, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.classList.add('center-card');
                cardDiv.innerHTML = `<h3>Áâå‰Ωç${index + 1}</h3><p>Ë∫´‰ªΩ: ${role}</p>`;
                centerDisplayDiv.appendChild(cardDiv);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderRoleSkills();
            updatePlayerCount(document.getElementById('playerCount').value);

            // Removed other old event listeners for buttons that are merged or removed.
        });
    </script>
</body>
</html>
